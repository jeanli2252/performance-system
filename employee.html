<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“¡å·¥é é¢ - ç¸¾æ•ˆç®¡ç†ç³»çµ±</title>
    <style>
        /* ===== 1. åŸºæœ¬è¨­å®š ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ===== 2. é ‚éƒ¨å°èˆªåˆ— ===== */
        .navbar {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-left h2 {
            color: #333;
            font-size: 20px;
        }

        .navbar-left p {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #ee5a52;
        }

        /* ===== 3. ä¸»è¦å…§å®¹å®¹å™¨ ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== 4. å¡ç‰‡æ¨£å¼ ===== */
        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card h3 {
            color: #333;
            font-size: 22px;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* ===== 5. è¡¨å–®æ¨£å¼ ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-size: 15px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===== 6. è©•åˆ†æ»‘æ¡¿æ¨£å¼ ===== */
        .rating-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .rating-container input[type="range"] {
            flex: 1;
        }

        .rating-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
            text-align: center;
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* ===== 7. æŒ‰éˆ•æ¨£å¼ ===== */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* ===== 8. æ­·å²è¨˜éŒ„è¡¨æ ¼ ===== */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .history-table th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-size: 14px;
            color: #333;
            border-bottom: 2px solid #667eea;
        }

        .history-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
            color: #666;
        }

        .history-table tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 30px;
            font-size: 14px;
        }

        /* ===== 9. éŸ¿æ‡‰å¼è¨­è¨ˆ ===== */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .history-table {
                font-size: 12px;
            }

            .history-table th,
            .history-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨å°èˆªåˆ— -->
    <div class="navbar">
        <div class="navbar-left">
            <h2>ğŸ¯ ç¸¾æ•ˆç®¡ç†ç³»çµ±</h2>
            <p id="welcomeMessage">æ­¡è¿å›ä¾†ï¼Œè¼‰å…¥ä¸­...</p>
        </div>
        <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="container">
        <!-- å¡«å¯«è‡ªè©•è¡¨å–® -->
        <div class="card">
            <h3>ğŸ“ å¡«å¯«ç¸¾æ•ˆè‡ªè©•</h3>
            <form id="performanceForm">
                <!-- è€ƒæ ¸å­£åº¦ -->
                <div class="form-group">
                    <label for="quarter">è€ƒæ ¸å­£åº¦ *</label>
                    <select id="quarter" name="quarter" required>
                        <option value="">è«‹é¸æ“‡å­£åº¦</option>
                        <option value="2024Q1">2024 ç¬¬ä¸€å­£ (Q1)</option>
                        <option value="2024Q2">2024 ç¬¬äºŒå­£ (Q2)</option>
                        <option value="2024Q3">2024 ç¬¬ä¸‰å­£ (Q3)</option>
                        <option value="2024Q4">2024 ç¬¬å››å­£ (Q4)</option>
                    </select>
                </div>

                <!-- å·¥ä½œæˆæœ -->
                <div class="form-group">
                    <label for="achievement">æœ¬å­£å·¥ä½œæˆæœ *</label>
                    <textarea 
                        id="achievement" 
                        name="achievement" 
                        placeholder="è«‹æè¿°æœ¬å­£åº¦çš„ä¸»è¦å·¥ä½œæˆæœã€å®Œæˆçš„å°ˆæ¡ˆæˆ–ä»»å‹™..."
                        required
                    ></textarea>
                </div>

                <!-- è‡ªæˆ‘è©•åˆ† -->
                <div class="form-group">
                    <label for="selfScore">è‡ªæˆ‘è©•åˆ† *</label>
                    <div class="rating-container">
                        <input 
                            type="range" 
                            id="selfScore" 
                            name="selfScore" 
                            min="1" 
                            max="5" 
                            value="3"
                            oninput="updateRatingDisplay()"
                        >
                        <span class="rating-value" id="ratingValue">3</span>
                    </div>
                    <div class="rating-labels">
                        <span>1 - éœ€å¤§å¹…æ”¹é€²</span>
                        <span>2 - å¾…æ”¹é€²</span>
                        <span>3 - ç¬¦åˆæœŸæœ›</span>
                        <span>4 - è¶…å‡ºæœŸæœ›</span>
                        <span>5 - å“è¶Šè¡¨ç¾</span>
                    </div>
                </div>

                <!-- éœ€è¦æ”¹é€²çš„åœ°æ–¹ -->
                <div class="form-group">
                    <label for="improvement">éœ€è¦æ”¹é€²çš„åœ°æ–¹</label>
                    <textarea 
                        id="improvement" 
                        name="improvement" 
                        placeholder="è«‹æè¿°ä½ èªç‚ºéœ€è¦æ”¹é€²æˆ–åŠ å¼·çš„åœ°æ–¹ï¼ˆé¸å¡«ï¼‰"
                    ></textarea>
                </div>

                <!-- æäº¤æŒ‰éˆ• -->
                <button type="submit" class="submit-btn">æäº¤è‡ªè©•è¡¨</button>
            </form>
        </div>

        <!-- æ­·å²ç¸¾æ•ˆè¨˜éŒ„ -->
        <div class="card">
            <h3>ğŸ“Š æ­·å²ç¸¾æ•ˆè¨˜éŒ„</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>å­£åº¦</th>
                        <th>è‡ªè©•åˆ†æ•¸</th>
                        <th>ä¸»ç®¡è©•åˆ†</th>
                        <th>ç‹€æ…‹</th>
                        <th>æäº¤æ™‚é–“</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <!-- é€™è£¡æœƒç”¨ JavaScript å‹•æ…‹å¡«å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ===== JavaScript éƒ¨åˆ† =====

        // 1. é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = function() {
            checkLogin();
            loadHistoryData();
        };

        // 2. æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        function checkLogin() {
            const currentUser = localStorage.getItem('currentUser');
            
            // å¦‚æœæ²’æœ‰ç™»å…¥è³‡æ–™ï¼Œå°å›ç™»å…¥é 
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥ï¼');
                window.location.href = 'index.html';
                return;
            }

            // è§£æä½¿ç”¨è€…è³‡æ–™
            const user = JSON.parse(currentUser);
            
            // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
            document.getElementById('welcomeMessage').textContent = 
                `æ­¡è¿å›ä¾†ï¼Œ${user.name}ï¼ˆ${user.username}ï¼‰`;
        }

        // 3. æ›´æ–°è©•åˆ†é¡¯ç¤º
        function updateRatingDisplay() {
            const score = document.getElementById('selfScore').value;
            document.getElementById('ratingValue').textContent = score;
        }

        // 4. è™•ç†è¡¨å–®æäº¤
        document.getElementById('performanceForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // å–å¾—è¡¨å–®è³‡æ–™
            const formData = {
                quarter: document.getElementById('quarter').value,
                achievement: document.getElementById('achievement').value,
                selfScore: document.getElementById('selfScore').value,
                improvement: document.getElementById('improvement').value,
                submitDate: new Date().toLocaleDateString('zh-TW'),
                status: 'pending'  // å¾…ä¸»ç®¡è©•åˆ†
            };

            // å–å¾—ç›®å‰ä½¿ç”¨è€…
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            // å„²å­˜ç¸¾æ•ˆè³‡æ–™åˆ° localStorageï¼ˆä¹‹å¾Œæœƒæ”¹æˆå­˜åˆ°å¾Œç«¯ï¼‰
            let performances = JSON.parse(localStorage.getItem('performances') || '[]');
            
            // åŠ å…¥ä½¿ç”¨è€…è³‡è¨Š
            formData.username = currentUser.username;
            formData.name = currentUser.name;
            
            performances.push(formData);
            localStorage.setItem('performances', JSON.stringify(performances));

            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            alert('âœ… è‡ªè©•è¡¨æäº¤æˆåŠŸï¼');

            // æ¸…ç©ºè¡¨å–®
            document.getElementById('performanceForm').reset();
            document.getElementById('ratingValue').textContent = '3';

            // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
            loadHistoryData();
        });

        // 5. è¼‰å…¥æ­·å²ç¸¾æ•ˆè³‡æ–™
        function loadHistoryData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const performances = JSON.parse(localStorage.getItem('performances') || '[]');
            
            // ç¯©é¸å‡ºç›®å‰ä½¿ç”¨è€…çš„ç¸¾æ•ˆè¨˜éŒ„
            const myPerformances = performances.filter(p => p.username === currentUser.username);

            const tbody = document.getElementById('historyTableBody');

            // å¦‚æœæ²’æœ‰è³‡æ–™
            if (myPerformances.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-message">å°šç„¡ç¸¾æ•ˆè¨˜éŒ„ï¼Œè«‹å¡«å¯«ç¬¬ä¸€ç­†è‡ªè©•è¡¨ï¼</td></tr>';
                return;
            }

            // é¡¯ç¤ºè³‡æ–™ï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
            tbody.innerHTML = myPerformances.reverse().map(p => `
                <tr>
                    <td>${p.quarter}</td>
                    <td>${p.selfScore} åˆ†</td>
                    <td>${p.managerScore || 'å¾…è©•åˆ†'}</td>
                    <td>
                        <span class="status-badge ${p.status === 'completed' ? 'status-completed' : 'status-pending'}">
                            ${p.status === 'completed' ? 'å·²å®Œæˆ' : 'å¾…ä¸»ç®¡è©•åˆ†'}
                        </span>
                    </td>
                    <td>${p.submitDate}</td>
                </tr>
            `).join('');
        }

        // 6. ç™»å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>